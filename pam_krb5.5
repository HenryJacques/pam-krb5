.\" Automatically generated by Pod::Man 2.08 (Pod::Simple 3.04)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sh \" Subsection heading
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  | will give a
.\" real vertical bar.  \*(C+ will give a nicer C++.  Capital omega is used to
.\" do unbreakable dashes and therefore won't be available.  \*(C` and \*(C'
.\" expand to `' in nroff, nothing in troff, for use with C<>.
.tr \(*W-|\(bv\*(Tr
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.Sh), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.if \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.\"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.hy 0
.if n .na
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "PAM_KRB5 5"
.TH PAM_KRB5 5 "2006-08-26" "2.1" "PAM Modules"
.SH "NAME"
pam_krb5 \- Kerberos v5 PAM module
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
.Vb 4
\&  auth            sufficient      pam_krb5.so ignore_root
\&  session         optional        pam_krb5.so ignore_root
\&  account         required        pam_krb5.so ignore_root
\&  password        optional        pam_krb5.so ignore_root
.Ve
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
The Kerberos v5 service module for \s-1PAM\s0, typically installed at
\&\fI/lib/security/pam_krb5.so\fR, provides functionality for the four \s-1PAM\s0
operations: authentication, account management, session management, and
password management.  \fIpam_krb5.so\fR is a shared object that is
dynamically loaded by the \s-1PAM\s0 subsystem as necessary, based on the system
\&\s-1PAM\s0 configuration.  \s-1PAM\s0 is a system for plugging in external
authentication and session management modules so that each application
doesn't have to know the best way to check user authentication or create a
user session on that system.  For details on how to configure \s-1PAM\s0 on your
system, see the \s-1PAM\s0 man page, often \fIpam\fR\|(7).
.PP
Here are the actions of this module when called from each group:
.IP "auth" 4
.IX Item "auth"
Provides implementations of \fIpam_authenticate()\fR and \fIpam_setcred()\fR.  The
former takes the username from the \s-1PAM\s0 session, prompts for the user's
password (unless configured to use an already-entered password), and then
performs a Kerberos initial authentication, storing the obtained
credentials (if successful) in a temporary ticket cache.  The latter,
depending on the flags it is called with, either takes the contents of the
temporary ticket cache and writes it out to a persistant ticket cache
owned by the user or uses the temporary ticket cache to refresh an
existing user ticket cache.
.Sp
After doing the initial authentication, the Kerberos \s-1PAM\s0 module will
attempt to obtain tickets for a key in the local system keytab and then
verify those tickets.  Unless this step is performed, the authentication
is vulnerable to \s-1KDC\s0 spoofing, but it requires that the system have a
local key and that the \s-1PAM\s0 module be running as a user that can read the
keytab file (normally \fI/etc/krb5.keytab\fR.  If that keytab cannot be read
or if no keys are found in it, the default (potentially insecure) behavior
is to skip this check.  If you want to instead fail authentication if the
obtained tickets cannot be checked, set \f(CW\*(C`verify_ap_req_nofail\*(C'\fR to true in
the [libdefaults] section of \fI/etc/krb5.conf\fR.  Note that this will
affect applications other than this \s-1PAM\s0 module.
.Sp
By default, whenever the user is authenticated, a basic authorization
check will also be done using \fIkrb5_kuserok()\fR.  The default behavior of
this function is to check the user's account for a \fI.k5login\fR file and,
if one is present, ensure that the user's principal is listed in that
file.  If \fI.k5login\fR is not present, the default check is to ensure that
the user's principal is in the default local realm and the user portion of
the principal matches the account name (this can be changed by configuring
a custom aname to localname mapping in \fIkrb5.conf\fR; see the Kerberos
documentation for details).  This can be customized with several
configuration options; see below.
.Sp
When \fIpam_setcred()\fR is called to initialize a new ticket cache, the
environment variable \s-1KRB5CCNAME\s0 is set to the path to that ticket cache.
By default, the cache will be named \fI/tmp/krb5cc_UID_RANDOM\fR where \s-1UID\s0 is
the user's \s-1UID\s0 and \s-1RANDOM\s0 is six randomly-chosen letters.  This can be
configured with the \fIccache\fR and \fIccache_dir\fR options.
.Sp
If \fIpam_setcred()\fR initializes a new ticket cache, it will also set up that
ticket cache so that it will be deleted when the \s-1PAM\s0 session is closed.
Normally, the calling program (\fBlogin\fR, \fBsshd\fR, etc.) will run the
user's shell as a sub\-process, wait for it to exit, and then close the \s-1PAM\s0
session, thereby cleaning up the user's session.
.IP "session" 4
.IX Item "session"
Provides implementations of \fIpam_open_session()\fR, which is equivalent to
calling \fIpam_setcred()\fR with the \s-1PAM_ESTABLISH_CRED\s0 flag, and
\&\fIpam_close_session()\fR, which destroys the ticket cache created by
\&\fIpam_setcred()\fR.
.IP "account" 4
.IX Item "account"
Provides an implementation of \fIpam_acct_mgmt()\fR.  All it does is do the same
authorization check as performed by the \fIpam_authenticate()\fR implementation
described above.
.IP "password" 4
.IX Item "password"
Provides an implementation of \fIpam_chauthtok()\fR, which implements password
changes.  The user is prompted for their existing password (unless
configured to use an already entered one) and the \s-1PAM\s0 module then obtains
credentials for the special Kerberos principal \f(CW\*(C`kadmin/changepw\*(C'\fR.  It
then prompts the user for a new password, twice to ensure that the user
entered it properly (again, unless configured to use an already entered
password), and then does a Kerberos password change.
.Sp
Unlike the normal Unix password module, this module will allow any user to
change any other user's password if they know the old password.  Also,
unlike the normal Unix password module, root will always be prompted for
the old password, since root has no special status in Kerberos.  (To
change passwords in Kerberos without knowing the old password, use
\&\fIkadmin\fR\|(8) instead.)
.PP
Both the account and session management calls of the Kerberos v5 \s-1PAM\s0
module will silently return success if called in the context of a \s-1PAM\s0
session for a user who did not authenticate with Kerberos.
.PP
Note that this module assumes the network is available in order to do a
Kerberos authentication, and if the network is not available, some
Kerberos libraries have timeouts longer than the timeout imposed by the
login process.  This means that using this module incautiously can make it
impossible to log on to console as root.  For this reason, you should
always use the \fIignore_root\fR or \fIminimum_uid\fR options, list a local
authentication module such as \fBpam_unix\fR first with a control field of
\&\f(CW\*(C`sufficient\*(C'\fR so that the Kerberos \s-1PAM\s0 module will be skipped if local
password authentication was successful.
.PP
This is not the same \s-1PAM\s0 module as the Kerberos \s-1PAM\s0 module available from
Sourceforge.  It supports many of the same options, has some additional
options, and doesn't support some of the options the Sourceforge module
does.
.SH "CONFIGURATION"
.IX Header "CONFIGURATION"
The Kerberos v5 \s-1PAM\s0 module takes many options, not all of which are
relevant to every \s-1PAM\s0 group; options that are not relevant will be
silently ignored.  Any of these options can be set in the \s-1PAM\s0
configuration as arguments listed after \f(CW\*(C`pam_krb5.so\*(C'\fR.  Some of the
options can also be set in the system \fIkrb5.conf\fR file; if this is
possible, it will be noted below in the option description.
.PP
To set a boolean option in the \s-1PAM\s0 configuration file, just give the name
of the option in the arguments.  To set an option that takes an argument,
follow the option name with an equal sign (=) and the value, with no
separating whitespace.  Whitespace in option arguments is not supported in
the \s-1PAM\s0 configuration.
.PP
To set an option for the \s-1PAM\s0 module in the system \fIkrb5.conf\fR file, put
that option in the [appdefaults] section.  The Kerberos v5 \s-1PAM\s0 module will
look for options either at the top level of the [appdefaults] section or
in a subsection named \f(CW\*(C`pam\*(C'\fR.  For example, the following fragment of a
\&\fIkrb5.conf\fR file would set \fIforwardable\fR to true and \fIminimum_uid\fR to
100:
.PP
.Vb 5
\&    [appdefaults]
\&        forwardable = true
\&        pam = {
\&            minimum_uid = 100
\&        }
.Ve
.PP
For more information on the syntax of \fIkrb5.conf\fR, see \fIkrb5.conf\fR\|(5).
.PP
There is no difference to the \s-1PAM\s0 module whether options are specified at
the top level or in a \f(CW\*(C`pam\*(C'\fR section; the \f(CW\*(C`pam\*(C'\fR section is supported in
case there are options that should be set for the \s-1PAM\s0 module but not for
other applications.
.PP
If the same option is set in \fIkrb5.conf\fR and in the \s-1PAM\s0 configuration,
the latter takes precedent.  Note, however, that due to the configuration
syntax, there's no way to turn off a boolean option in the \s-1PAM\s0
configuration that was turned on in \fIkrb5.conf\fR.
.IP "ccache=<pattern>" 4
.IX Item "ccache=<pattern>"
Use <pattern> as the pattern for creating credential cache names.
<pattern> must be in the form <type>:<residual> where <type> and the
following colon are optional if a file cache should be used.  The special
token \f(CW%u\fR, anywhere in <pattern>, is replaced with the user's numeric
\&\s-1UID\s0.  The special token \f(CW%p\fR, anywhere in <pattern>, is replaced with the
current process \s-1ID\s0.
.Sp
If <pattern> ends in the literal string \f(CW\*(C`XXXXXX\*(C'\fR (six X's), that string
will be replaced by randomly generated characters and the ticket cache
will be created using \fImkstemp\fR\|(3).  This is strongly recommended if
<pattern> points to a world-writable directory.
.Sp
This option can be set in \fIkrb5.conf\fR and is only applicable to the auth
and session groups.
.IP "ccache_dir=<directory>" 4
.IX Item "ccache_dir=<directory>"
Store user ticket caches in <directory> instead of in \fI/tmp\fR.  The
algorithm for generating the ticket cache name is otherwise unchanged.
.Sp
This option can be set in \fIkrb5.conf\fR and is only applicable to the auth
and session groups.
.IP "debug" 4
.IX Item "debug"
Log more verbose trace and debugging information to syslog at \s-1LOG_DEBUG\s0
priority, including entry and exit from each of the external \s-1PAM\s0
interfaces (except pam_close_session).
.Sp
This option can be set in \fIkrb5.conf\fR.
.IP "forwardable" 4
.IX Item "forwardable"
Obtain forwardable tickets.  If set (to either true or false, although it
can only be set to false in \fIkrb5.conf\fR), this overrides the Kerberos
library default set in the [libdefaults] section of \fIkrb5.conf\fR.
.Sp
This option can be set in \fIkrb5.conf\fR and is only applicable to the auth
group.
.IP "ignore_k5login" 4
.IX Item "ignore_k5login"
Never look for a \fI.k5login\fR file in the user's home directory.  Instead,
only check that the Kerberos principal maps to the local account name.
The default check is to ensure the realm matches the local realm and the
user portion of the principal matches the local account name, but this can
be customized by setting up an aname to localname mapping in \fIkrb5.conf\fR.
.Sp
This option can be set in \fIkrb5.conf\fR and is only applicable to the auth
and account groups.
.IP "ignore_root" 4
.IX Item "ignore_root"
Do not do anything if the username is \f(CW\*(C`root\*(C'\fR.  The authentication and
password calls will silently fail (allowing that status to be ignored via
a control of \f(CW\*(C`optional\*(C'\fR or \f(CW\*(C`sufficient\*(C'\fR), and the account and session
calls (including pam_setcred) will silently succeed.  This option is
supported and will remain, but normally you want to use \fIminimum_uid\fR
instead.
.Sp
This option can be set in \fIkrb5.conf\fR.
.IP "minimum_uid=<uid>" 4
.IX Item "minimum_uid=<uid>"
Do not do anything if the authenticated account name corresponds to a
local account and that local account has a \s-1UID\s0 lower than <uid>.  If both
of those conditions are true, the authentication and password calls will
silently fail (allowing that status to be ignored via a control of
\&\f(CW\*(C`optional\*(C'\fR or \f(CW\*(C`sufficient\*(C'\fR), and the account and session calls
(including pam_setcred) will silently succeed.  Using this option is
highly recommended if you don't need to use Kerberos to authenticate
password logins to the root account (which isn't recommended since
Kerberos requires a network connection).
.Sp
This option can be set in \fIkrb5.conf\fR.
.IP "no_ccache" 4
.IX Item "no_ccache"
Do not create a ticket cache after authentication.  This option shouldn't
be set in general, but is useful as part of the \s-1PAM\s0 configuration for a
particular service that uses \s-1PAM\s0 for authentication but isn't creating
user sessions and doesn't want the overhead of ever writing the user
credentials to disk.  When using this option, the application should only
call \fIpam_authenticate()\fR; other functions like \fIpam_setcred()\fR and
\&\fIpam_start_session()\fR don't make sense with this option.
.Sp
This option is only applicable to the auth group.
.IP "renew_lifetime=<lifetime>" 4
.IX Item "renew_lifetime=<lifetime>"
Obtain renewable tickets with a maximum renewable lifetime of <lifetime>.
<lifetime> should be a Kerberos lifetime string such as \f(CW\*(C`2d4h10m\*(C'\fR or a
time in minutes.  If set, this overrides the Kerberos library default set
in the [libdefaults] section of \fIkrb5.conf\fR.
.Sp
This option can be set in \fIkrb5.conf\fR and is only applicable to the auth
group.
.IP "search_k5login" 4
.IX Item "search_k5login"
Normally, the Kerberos implementation of pam_authenticate attempts to
obtain tickets for the authenticating username in the local realm.  If
this option is set and the local user has a \fI.k5login\fR file in their home
directory, the module will instead open and read that \fI.k5login\fR file,
attempting to use the supplied password to authenticate as each principal
listed there in turn.  If any of those authentications succeed, the user
will be successfully authenticated; otherwise, authentication will fail.
This option is useful for allowing password authentication (via console or
sshd without GSS-API support) to shared accounts.  If there is no
\&\fI.k5login\fR file, the behavior is the same as normal.  Using this option
requires that the user's \fI.k5login\fR file be readable at the time of
authentication.
.Sp
This option can be set in \fIkrb5.conf\fR and is only applicable to the auth
group.
.IP "try_first_pass" 4
.IX Item "try_first_pass"
If the authentication module isn't the first on the stack, and a previous
module obtained the user's password, use that password to authenticate the
user without prompting them again.  If that authentication fails, fall
back on prompting the user for their password.  This option has no effect
if the authentication module is first in the stack or if no previous
module obtained the user's password.
.Sp
This option is only applicable to the auth and password groups.  For the
password group, it applies to both the old and new passwords.
.IP "use_authtok" 4
.IX Item "use_authtok"
Use the password obtained by a previous authentication module to
authenticate the user and any password obtained by a previous password
module for the new password when changing passwords.  If these passwords
aren't available, fail.  Never prompt the user for a password under any
circumstances.  This can be used to require passwords be checked by
another, prior module, such as \fBpam_cracklib\fR.
.Sp
This option is only applicable to the auth and password groups.
.IP "use_first_pass" 4
.IX Item "use_first_pass"
Use the password obtained by a previous authentication module to
authenticate the user, and the password obtained by a previous password
module as the new password when changing passwords, without prompting the
user again again.  If no previous module obtained the user's password for
either an authentication or password change, fall back on prompting the
user.  If a previous module did obtain the user's password but
authentication with that password fails, fail without further prompting
the user.
.Sp
This option is only applicable to the auth and password groups.
.SH "ENVIRONMENT"
.IX Header "ENVIRONMENT"
.IP "\s-1KRB5CCNAME\s0" 4
.IX Item "KRB5CCNAME"
Set by \fIpam_setcred()\fR with the \s-1PAM_ESTABLISH_CRED\s0 option, and therefore
also by \fIpam_open_session()\fR, to point to the new credential cache for the
user.  See the \fIccache\fR and \fIccache_dir\fR options.
.IP "\s-1PAM_KRB5CCNAME\s0" 4
.IX Item "PAM_KRB5CCNAME"
Set by \fIpam_authenticate()\fR to point to the temporary ticket cache used for
authentication (unless the \fIno_ccache\fR option was given).  \fIpam_setcred()\fR
then uses that environment variable to locate the temporary cache even if
it was not called in the same \s-1PAM\s0 session as \fIpam_authenticate()\fR (a problem
with \fBsshd\fR running in some modes).  This environment variable is only
used internal to the \s-1PAM\s0 module.
.SH "FILES"
.IX Header "FILES"
.IP "\fI/tmp/krb5cc_UID_RANDOM\fR" 4
.IX Item "/tmp/krb5cc_UID_RANDOM"
The default credential cache name.  \s-1UID\s0 is the decimal \s-1UID\s0 of the local
user and \s-1RANDOM\s0 is a random six-character string.  The pattern may be
changed with the \fIccache\fR option and the directory with the \fIccache_dir\fR
option.
.IP "\fI/tmp/krb5cc_pam_RANDOM\fR" 4
.IX Item "/tmp/krb5cc_pam_RANDOM"
The credential cache name used for the temporary credential cache created
by \fIpam_authenticate()\fR.  This cache is removed again when the \s-1PAM\s0 session
is ended or when \fIpam_setcred()\fR is called and will normally not be
user\-visible.  \s-1RANDOM\s0 is a random six-character string.
.IP "\fI~/.k5login\fR" 4
.IX Item "~/.k5login"
File containing Kerberos principals that are allowed access to that
account.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fIkadmin\fR\|(8), \fIkdestroy\fR\|(1), \fIkrb5.conf\fR\|(5), \fIpam\fR\|(7), \fIpasswd\fR\|(1), \fIsyslog\fR\|(3)
